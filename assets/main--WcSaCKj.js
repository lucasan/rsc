function e(e,t){e=new Date(e.getFullYear(),e.getMonth(),e.getDate());const n=(t=new Date(t.getFullYear(),t.getMonth(),t.getDate()))-e,s=Math.ceil(n/864e5)+1;return s>=1&&s<=365?s:null}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class t{constructor(e){this.context=e}debug(e,t={}){}error(e,t={}){}warn(e,t={}){}}const n=new t("DayCell");class s{constructor(e,t={}){this.date=e,this.isToday=t.isToday||!1,this.isSelected=t.isSelected||!1,this.stepNumber=t.stepNumber,this.stepTitle=t.stepTitle,this.isEmpty=t.isEmpty||!1}render(){if(this.isEmpty)return'<div class="p-2 md:p-4 border border-transparent"></div>';const e=this.date.getDate();return n.debug("Rendering cell with:",{day:e,stepNumber:this.stepNumber,stepTitle:this.stepTitle,hasTitle:!!this.stepTitle}),`\n            <div class="day-cell relative border rounded-lg transition-all duration-200\n                aspect-square w-[40px] md:w-auto md:min-h-[100px] \n                flex items-center justify-center md:block\n                ${this.isToday?"bg-blue-50 border-blue-200":"border-gray-100 hover:border-blue-300"}\n                ${this.isSelected?"bg-blue-100 border-blue-400":""}\n                focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\n                cursor-pointer p-2 md:overflow-clip"\n                data-date="${this.date.toISOString()}"\n                role="button"\n                aria-label="${e}${this.stepNumber?` - Step ${this.stepNumber}`:""}"\n            >\n                <span class="text-sm ${this.isToday?"font-bold":""}">${e}</span>\n                ${this.stepNumber?`\n                    <div class="absolute bottom-1 right-1 w-1.5 h-1.5 rounded-full bg-blue-600 md:hidden"></div>\n                    <div class="text-xs hidden md:block p-2">\n                        <span class="font-medium text-blue-600">Step ${this.stepNumber}</span>\n                        ${this.stepTitle?`\n                            <p class="mt-1 text-gray-600 line-clamp-5 overflow-hidden">${this.stepTitle}</p>\n                        `:""}\n                    </div>\n                `:""}\n            </div>\n        `}}const a={PROGRAM_START_DATE:new Date(2025,0,30),TOTAL_STEPS:365};class r{constructor(e){this.container=e,this.isOpen=!1,this.currentStep=null,this.handleClose=this.handleClose.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.handleOverlayClick=this.handleOverlayClick.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this),this.handleTouchEnd=this.handleTouchEnd.bind(this),document.addEventListener("keydown",this.handleKeydown),this.touchStartY=0,this.touchDeltaY=0,this.lastFocusedElement=null}open(e){this.lastFocusedElement=document.activeElement,this.currentStep=e,this.isOpen=!0,this.render(),this.updateURL();const t=this.container.querySelector(".panel-content");t&&(t.setAttribute("tabindex","0"),t.focus())}close(){if(!this.isOpen)return;this.container.querySelector(".transform").classList.remove("show"),setTimeout((()=>{this.isOpen=!1,this.currentStep=null,this.render(),this.updateURL(),this.lastFocusedElement&&this.lastFocusedElement.focus()}),500)}handleClose(){this.close()}handleKeydown(e){"Escape"===e.key&&this.isOpen&&this.close()}handleOverlayClick(e){e.target.classList.contains("overlay-bg")&&this.close()}updateURL(){const e=new URL(window.location);this.isOpen&&this.currentStep?e.searchParams.set("step",this.currentStep.step_number):e.searchParams.delete("step"),window.history.pushState({},"",e)}render(){if(!this.isOpen)return void(this.container.innerHTML="");const e=this.currentStep;this.container.innerHTML=`\n            <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity overlay-bg">\n                <div class="fixed inset-y-0 right-0 w-full md:max-w-4xl bg-white shadow-xl transform transition-transform duration-500 overflow-y-auto">\n                    \x3c!-- Decorative top bar --\x3e\n                    <div class="hidden md:block h-1 bg-gradient-to-r from-blue-500 to-blue-600"></div>\n                    \n                    <div class="relative p-4 md:p-12">\n                        \x3c!-- Mobile header --\x3e\n                        <div class="flex items-center justify-between md:hidden mb-4">\n                            <div class="text-sm font-medium text-blue-600">\n                                Step ${e.step_number}\n                            </div>\n                            <button \n                                class="mobile-close p-2 text-gray-500 hover:text-gray-700"\n                                aria-label="Close panel"\n                            >\n                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />\n                                </svg>\n                            </button>\n                        </div>\n                        \n                        \x3c!-- Desktop close button --\x3e\n                        <button \n                            class="desktop-close absolute right-4 text-gray-400 hover:text-gray-600 transition-colors duration-200 hidden md:block"\n                            aria-label="Close panel"\n                        >\n                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12" />\n                            </svg>\n                        </button>\n                        \n                        \x3c!-- Content for both mobile and desktop --\x3e\n                        <div class="panel-content space-y-8 max-w-2xl focus:outline-none"\n                             tabindex="0"\n                             role="region"\n                             aria-label="Step details">\n                            \x3c!-- Step number (desktop only) --\x3e\n                            <div class="hidden md:block text-sm font-medium text-blue-600 tracking-wide uppercase">\n                                Step ${e.step_number}\n                            </div>\n                            \n                            \x3c!-- Title --\x3e\n                            <h2 class="text-xl md:text-3xl font-bold text-gray-900 leading-tight">\n                                ${e.step_of_the_day.title}\n                            </h2>\n                            \n                            \x3c!-- Review and Appreciate --\x3e\n                            ${e.review_and_appreciate?`\n                                <div class="panel-section md:bg-transparent md:p-0">\n                                    <h3 class="text-lg md:text-xl font-semibold text-gray-800 mb-3">Review and Appreciate</h3>\n                                    <p class="text-gray-600 leading-relaxed">${e.review_and_appreciate}</p>\n                                </div>\n                            `:""}\n                            \n                            \x3c!-- Main content --\x3e\n                            <div class="panel-section md:bg-transparent md:p-0">\n                                <h3 class="text-lg md:text-xl font-semibold text-gray-800 mb-3">Today's Step</h3>\n                                <p class="text-gray-600 leading-relaxed">${e.step_of_the_day.content}</p>\n                            </div>\n                            \n                            \x3c!-- Action step --\x3e\n                            <div class="panel-section md:bg-blue-50 md:p-6 md:rounded-xl">\n                                <h3 class="text-lg md:text-xl font-semibold text-gray-800 mb-3">\n                                    <span class="md:text-blue-600">Action Step</span>\n                                </h3>\n                                <p class="text-gray-600 md:text-gray-700 leading-relaxed">${e.action_step}</p>\n                            </div>\n                            \n                            \x3c!-- Journal entry --\x3e\n                            <div class="panel-section md:bg-gray-50 md:p-6 md:rounded-xl">\n                                <h3 class="text-lg md:text-xl font-semibold text-gray-800 mb-3">Journal Entry</h3>\n                                <p class="text-gray-600 leading-relaxed">${e.journal_entry}</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,this.container.querySelectorAll(".mobile-close, .desktop-close").forEach((e=>{e.addEventListener("click",this.handleClose)})),this.container.querySelector(".overlay-bg").addEventListener("click",this.handleOverlayClick);const t=this.container.querySelector(".transform");requestAnimationFrame((()=>{requestAnimationFrame((()=>{t.classList.add("show")}))}))}addTouchHandlers(){const e=this.container.querySelector(".transform");e.addEventListener("touchstart",this.handleTouchStart),e.addEventListener("touchmove",this.handleTouchMove),e.addEventListener("touchend",this.handleTouchEnd)}handleTouchStart(e){this.touchStartY=e.touches[0].clientY}handleTouchMove(e){if(this.touchDeltaY=e.touches[0].clientY-this.touchStartY,this.touchDeltaY>0){e.preventDefault();this.container.querySelector(".transform").style.transform=`translateY(${this.touchDeltaY}px)`}}handleTouchEnd(){const e=this.container.querySelector(".transform");this.touchDeltaY>100?this.close():e.style.transform="",this.touchDeltaY=0}}const i=new t("StepService");class o{constructor(){this.cache=new Map,this.loading=new Map,this.baseUrl="./src/data/steps"}async getStep(e){try{if(i.debug("Getting step",{stepNumber:e}),!this.isValidStepNumber(e))throw new Error(`Invalid step number: ${e}`);if(this.cache.has(e))return i.debug("Cache hit",{stepNumber:e}),this.cache.get(e);if(this.loading.has(e))return i.debug("Already loading",{stepNumber:e}),this.loading.get(e);const t=this.fetchStep(e);this.loading.set(e,t);const n=await t;return i.debug("Fetched step data",{stepNumber:e,step:n}),this.cache.set(e,n),this.loading.delete(e),n}catch(t){throw i.error("Error getting step",{stepNumber:e,error:t}),this.loading.delete(e),t}}async fetchStep(e){try{const t=`${this.baseUrl}/${e}.json`;i.debug("Fetching step",{url:t,stepNumber:e});const n=await fetch(t);if(i.debug("Fetch response",{status:n.status,ok:n.ok,stepNumber:e,url:t}),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();return i.debug("Raw step data",{stepNumber:e,data:s,dataType:typeof s,hasStepNumber:!!(null==s?void 0:s.step_number),hasStepOfDay:!!(null==s?void 0:s.step_of_the_day)}),this.validateStepData(s)}catch(t){throw i.error("Fetch error",{stepNumber:e,error:t.message,errorType:t.constructor.name,stack:t.stack}),t}}isValidStepNumber(e){const t=Number(e);return!isNaN(t)&&t>=1&&t<=365}validateStepData(e){var t,n;if(i.debug("Validating step data structure",{data:e,hasStepNumber:!!(null==e?void 0:e.step_number),hasStepOfDay:!!(null==e?void 0:e.step_of_the_day),stepNumberType:typeof(null==e?void 0:e.step_number),stepOfDayType:typeof(null==e?void 0:e.step_of_the_day)}),e.step_number&&(e.step_number=String(e.step_number).replace(/[^0-9]/g,"")),!e.step_number||!e.step_of_the_day)throw new Error("Invalid step data structure: missing "+(e.step_number?"step_of_the_day":"step_number"));return i.debug("Step data validated",{stepNumber:e.step_number,title:null==(t=e.step_of_the_day)?void 0:t.title,hasTitle:!!(null==(n=e.step_of_the_day)?void 0:n.title)}),e}clearCache(){i.debug("Clearing cache"),this.cache.clear(),this.loading.clear()}setBaseUrl(e){this.baseUrl=e}async getStepsForMonth(t,n){i.debug("Getting steps for month",{year:t,month:n});const s=new Date(t,n,1),r=new Date(t,n+1,0),o=new Set,l=new Date(s);for(;l<=r;){if(l>=a.PROGRAM_START_DATE){const t=e(a.PROGRAM_START_DATE,l);t&&t>0&&o.add(t)}l.setDate(l.getDate()+1)}i.debug("Step numbers for month",{year:t,month:n,stepNumbers:Array.from(o),count:o.size,firstDay:s.toISOString(),lastDay:r.toISOString(),programStart:a.PROGRAM_START_DATE.toISOString()});const d=Array.from(o).map((e=>this.getStep(e))),c=(await Promise.all(d)).filter(Boolean);return i.debug("Month steps loaded",{year:t,month:n,requested:o.size,loaded:c.length,missing:o.size-c.length}),c}}const l=new t("Calendar");class d{constructor(e){this.container=e,this.currentDate=new Date,this.currentDate.setFullYear(a.PROGRAM_START_DATE.getFullYear()),this.selectedDate=null,this.startDate=a.PROGRAM_START_DATE,this.handleClick=this.handleClick.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.container.addEventListener("click",this.handleClick),e.setAttribute("tabindex","0"),e.addEventListener("keydown",this.handleKeydown),this.stepService=new o,this.monthSteps=new Map,this.panelContainer=document.createElement("div"),document.body.appendChild(this.panelContainer),this.stepPanel=new r(this.panelContainer),(async()=>{await this.render()})()}async loadCurrentMonthSteps(){const e=this.currentDate.getFullYear(),t=this.currentDate.getMonth();l.debug("Starting to load month steps",{year:e,month:t});try{const n=await this.stepService.getStepsForMonth(e,t);l.debug("Got steps from service",{count:n.length,steps:n}),this.monthSteps.clear(),n.forEach((e=>{var t;const n=String(e.step_number);l.debug("Adding step to month cache",{stepNumber:n,title:null==(t=e.step_of_the_day)?void 0:t.title}),this.monthSteps.set(n,e)})),l.debug("Finished loading month steps",{count:this.monthSteps.size,cached:Array.from(this.monthSteps.keys())})}catch(n){l.error("Failed to load month steps",{error:n})}}async getStepForDate(t){try{const n=e(this.startDate,t);if(!n)return null;const s=String(n);if(this.monthSteps.has(s))return l.debug("Cache hit for step",{stepNumber:n,stepNumberStr:s}),this.monthSteps.get(s);return t.getMonth()===this.currentDate.getMonth()&&t.getFullYear()===this.currentDate.getFullYear()?(await this.loadCurrentMonthSteps(),this.monthSteps.get(s)):await this.stepService.getStep(n)}catch(n){return l.error("Error getting step for date",{date:t,error:n}),null}}createNavigation(){return`\n            <div class="flex items-center justify-between mb-6 px-2">\n                <button \n                    class="prev-month p-3 hover:bg-gray-100 rounded-full transition-colors duration-200"\n                    tabindex="0"\n                    aria-label="Previous month"\n                >\n                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>\n                    </svg>\n                </button>\n                <h2 class="text-2xl font-bold text-gray-800" id="current-month">\n                    ${this.currentDate.toLocaleString("default",{month:"long",year:"numeric"})}\n                </h2>\n                <button \n                    class="next-month p-3 hover:bg-gray-100 rounded-full transition-colors duration-200"\n                    tabindex="0"\n                    aria-label="Next month"\n                >\n                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>\n                    </svg>\n                </button>\n            </div>\n        `}createWeekHeaders(){return`\n            <div class="grid grid-cols-7 gap-2 mb-4">\n                ${["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((e=>`\n                    <div class="text-center text-gray-500 font-semibold tracking-wider text-sm">\n                        ${e}\n                    </div>\n                `)).join("")}\n            </div>\n        `}getDaysInMonth(e){const t=e.getFullYear(),n=e.getMonth(),s=new Date(t,n,1);return{daysInMonth:new Date(t,n+1,0).getDate(),startingDay:s.getDay()}}async createCalendarGrid(){var t,n;const{daysInMonth:a,startingDay:r}=this.getDaysInMonth(this.currentDate);let i=[];for(let e=0;e<r;e++){const e=new s(null,{isEmpty:!0});i.push(e.render())}await this.loadCurrentMonthSteps();for(let o=1;o<=a;o++){const a=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),o),r=e(this.startDate,a),d=r?this.monthSteps.get(String(r)):null;l.debug("Creating cell with step data",{date:a,stepNumber:r,hasStep:!!d,title:null==(t=null==d?void 0:d.step_of_the_day)?void 0:t.title});const c=new s(a,{isToday:this.isToday(a),isSelected:this.isSelected(a),stepNumber:r,stepTitle:(null==(n=null==d?void 0:d.step_of_the_day)?void 0:n.title)||null});i.push(c.render())}return`\n            <div class="grid grid-cols-7 gap-1 md:gap-2">\n                ${i.join("")}\n            </div>\n        `}isToday(e){const t=new Date;return e.toDateString()===t.toDateString()}isSelected(e){return this.selectedDate&&e.toDateString()===this.selectedDate.toDateString()}async handleClick(e){const t=e.target.closest(".day-cell");t&&t.dataset.date&&this.selectDate(new Date(t.dataset.date))}handleKeydown(e){if(document.activeElement===this.container){if(!this.selectedDate)return this.selectedDate=this.isToday(this.currentDate)?new Date:new Date(this.currentDate.getFullYear(),this.currentDate.getMonth(),1),void this.render();switch(e.key){case"ArrowLeft":e.preventDefault(),this.navigateDate(-1);break;case"ArrowRight":e.preventDefault(),this.navigateDate(1);break;case"ArrowUp":e.preventDefault(),this.navigateDate(-7);break;case"ArrowDown":e.preventDefault(),this.navigateDate(7);break;case"Enter":case" ":e.preventDefault(),this.selectedDate&&this.selectDate(this.selectedDate)}}}navigateDate(e){const t=new Date(this.selectedDate);if(t.setDate(t.getDate()+e),t.getFullYear()===a.PROGRAM_START_DATE.getFullYear()){t.getMonth()!==this.currentDate.getMonth()&&(this.currentDate=t),this.selectedDate=t,this.render();const e=this.container.querySelector(`[data-date="${t.toISOString()}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})}}async navigateMonth(e){const t=new Date(this.currentDate.getFullYear(),this.currentDate.getMonth()+e,1);t.getFullYear()===a.PROGRAM_START_DATE.getFullYear()&&(this.currentDate=t,await this.loadCurrentMonthSteps(),await this.render())}async render(){var e;this.container.innerHTML=`\n            <div class="calendar-container p-6 bg-white rounded-xl shadow-lg">\n                ${this.createNavigation()}\n                ${this.createWeekHeaders()}\n                ${await this.createCalendarGrid()}\n            </div>\n        `;const t=this.container.querySelector(".prev-month"),n=this.container.querySelector(".next-month");null==t||t.addEventListener("click",(()=>this.navigateMonth(-1))),null==t||t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.navigateMonth(-1))})),null==n||n.addEventListener("click",(()=>this.navigateMonth(1))),null==n||n.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.navigateMonth(1))})),this.addEventListeners();const s=this.container.querySelector(`[data-date="${null==(e=this.selectedDate)?void 0:e.toISOString()}"]`);s&&(s.setAttribute("tabindex","0"),document.activeElement===this.container&&s.focus())}addEventListeners(){this.container.querySelectorAll(".day-cell[data-date]").forEach(((e,t)=>{e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.setAttribute("aria-label",`${new Date(e.dataset.date).getDate()}`);const n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",(()=>this.selectDate(new Date(n.dataset.date)))),n.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.selectDate(new Date(n.dataset.date)))}))}))}async selectDate(e){const t=this.container.querySelector(".bg-blue-100");t&&t.classList.remove("bg-blue-100","border-blue-400");const n=this.container.querySelector(`[data-date="${e.toISOString()}"]`);n&&n.classList.add("bg-blue-100","border-blue-400"),this.selectedDate=e;const s=await this.getStepForDate(this.selectedDate);l.debug("Selected date step data",{date:e,hasStep:!!s}),s&&this.stepPanel.open(s),this.container.dispatchEvent(new CustomEvent("dateSelected",{detail:{date:this.selectedDate}}))}}const c=new t("Main");!async function(){try{const e=document.getElementById("calendar");new d(e);e.addEventListener("dateSelected",(e=>{c.debug("Selected date:",e.detail.date)}))}catch(e){c.error("Error initializing calendar:",e)}}();
